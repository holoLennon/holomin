appctrl.controller("OrderrListCtrl",function(e,t,r,i,a,n,s,o,l,d,u,c,f,g,p,m,h,b,v){g.debug("enter OrderrList Ctrl");e.status=u.status;e.listDiscartreason=[{id:1,value:"地址无法配送"},{id:2,value:"联系不上用户"},{id:3,value:"不肯押押金"},{id:4,value:"重复订单"},{id:5,value:"假订单"},{id:-1,value:"其他"}];e.$on("$ionicView.beforeEnter",function(){g.debug("OrderrList Ctrl beforeEnter")});e.$on("$ionicView.afterEnter",function(){g.debug("OrderrList Ctrl afterEnter")});e.login=function(){t.$broadcast("event.NeedLoginException","OrderrList")};e.init=function(){var r=v.get(LOGINED_USER);if(r==null){l.path("/tab/my");t.$broadcast("event.NeedLoginException");return}e.user=r;e.list=[];e.page=h.getPage();e.page.orderstr="gmtCreate desc";e.page.pageNo=1;e.page.hasNextPage=false;if(e.status=="orderrA")e.first("status  = 0  and  iotype=2");else if(e.status=="orderrC")e.first("status  = 0  and  iotype=0");else if(e.status=="orderrB")e.first("status  = 2 and  iotype=2");else if(e.status=="orderrD")e.first("status  = 2 and  iotype=0");else if(e.status=="all"){e.first("iotype=2")}else if(e.status=="all2"){e.first("iotype=0")}};e.doRefresh=function(){e.init()};e.addList=function(t){g.debug(t);angular.forEach(t,function(t){e.list.push(t)});if(t&&t.length<e.page.pageSize){e.page.hasNextPage=false}else{e.page.hasNextPage=true}if(e.list.length<1){p.alertm("您还没有订单")}};e.first=function(t){g.debug("OrderrList first "+t);h.first(t).then(function(t){g.debug("OrderrList query then");e.addList(t);g.debug("请求列表");g.debug(t);e.$broadcast("scroll.refreshComplete")})};e.more=function(){g.debug("OrderrList more=========");if(!e.page.hasNextPage){return}h.more().then(function(t){g.debug("OrderrList more then");e.addList(t);e.$broadcast("scroll.infiniteScrollComplete")})};e.cancel=function(t){e.selectedOrderr=t;e.showReasonDialog()};e.confirm=function(t){e.page.cmd=cmd_ORDERR_CONFIRM;h.update(t).then(function(){p.alertm("成功接单，订单已放入待送订单");e.init()});e.page.cmd=""};e.send=function(t){e.page.cmd=cmd_ORDERR_SEND;h.update(t).then(function(){p.alertm("成功发货，订单已放入送出订单");e.init()});e.page.cmd=""};e.showReasonDialog=function(){e.dialog=n.show({template:'<ul class="invalid_reason">'+'  <li ng-repeat="item in listDiscartreason" ng-click="selectedItem(item)"> '+"    {{item.value}}"+"  </li>"+"</ul>",title:"请选择无效原因",scope:e,buttons:[{text:"关闭"}]})};e.selectedItem=function(t){e.dialog.close();var r=e.selectedOrderr;r.discardreason=t.id;e.page.cmd=cmd_ORDERR_CANCEL;h.update(r).then(function(){p.alertm("订单已取消");e.init()});e.page.cmd=""};e.init();e.transformTime=function(e){if(e==null){return""}var t=(new Date).getDate();var r=new Date(e);var i=r.getDate();var a=r.getHours();var n="";if(i-t==0){n="今天"}else if(i-t==1){n="明天"}else if(i-t==2){n="后天"}else{n=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getUTCDate()}return n+" "+a+":00"+"-"+(a+1)+":00"}});