appctrl.controller("DrugstoreListMapCtrl",function(e,t,r,n,i,a,o,c,s,l,u,g,p,f,m,d,h){g.debug("enter DrugstoreList ctrl");e.page=_.clone(_Page);e.list=[];e.map={};e.$on("$ionicView.beforeEnter",function(){g.debug("DrugstoreList ctrl beforeEnter")});e.$on("$ionicView.afterEnter",function(){g.debug("DrugstoreList ctrl afterEnter");if(ctrlReinitMap.get("DrugstoreListMapCtrl")){ctrlReinitMap.remove("DrugstoreListMapCtrl");g.debug("DrugstoreList ctrl afterEnter init");e.init()}});e.init=function(){g.debug("DrugstoreList ctrl init ");e.pcc=areaTree;e.province=areaTree[3];e.city=e.province.children[0];e.county=e.city.children[1];e.query="";e.page.where="areaid="+e.county.id;e.page.pageNo=1;e.page.hasNextPage=false;e.list=[];e.first()};e.doRefresh=function(){e.init()};e.addList=function(t){angular.forEach(t,function(t){e.list.push(t);e.mapMarker(t)});if(t&&t.length<e.page.pageSize){e.page.hasNextPage=false}else{e.page.hasNextPage=true}};e.first=function(){m.first(null,e.page).then(function(t){g.debug("DrugstoreList ctrl query then");e.addList(t);e.mapCenterToFirst();e.$broadcast("scroll.refreshComplete")})};e.more=function(){g.debug("DrugstoreList ctrl more=========");if(!e.page.hasNextPage){return}m.more(e.page).then(function(t){g.debug("DrugstoreList ctrl more then");e.addList(t);e.$broadcast("scroll.infiniteScrollComplete")})};e.mapinit=function(){g.debug("mapinit ");e.map=d.createMap("amap","gaode_container_shopdrugstore")};e.mapCenterToFirst=function(){g.debug("mapCenterToFirst ");var t=e.list[0];var r=[120.198112,30.208539];if(t&&t.centerlng&&t.centerlat&&t.centerlng!=0&&t.centerlat!=0)r=[t.centerlng,t.centerlat];e.mapCenterTo(r)};e.mapCenterTo=function(t){g.debug("mapCenterTo ");e.map.setZoomAndCenter(14,t)};e.mapMarker=function(t){if(t.obj1){return}var r=[120.198112,30.208539];if(t&&t.centerlng&&t.centerlat&&t.centerlng!=0&&t.centerlat!=0)r=[t.centerlng,t.centerlat];var n=new AMap.Marker({icon:"http://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",position:r});n.setMap(e.map)};e.yaodianlianxi=function(t){e.mapCenterTo([t.centerlng,t.centerlat]);h.alertm("请与药店客服联系")};e.searchByCounty=function(t){if(t==e.city.children[0]){h.alertm("请选择 区")}e.county=t;e.query="areaid="+e.county.id;e.page.where=e.query;e.list=[];e.first()};e.mapinit();e.init();ctrlReinitMap.remove("DrugstoreListMapCtrl")});