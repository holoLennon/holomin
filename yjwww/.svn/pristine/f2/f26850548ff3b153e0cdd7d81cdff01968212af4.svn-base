appservice.factory("sessionInjector",["$rootScope","$q","Storage",function(e,r,t){return{request:function(e){if(e.params){var n=t.get(CLIENT_INFO);if(n){if(n.ver)e.params.ver=n.ver;if(n.cli)e.params.cli=n.cli;if(n.openid)e.params.openid=n.openid;if(n.openidmd5)e.params.openidmd5=n.openidmd5;if(n.token)e.params.token=n.token}else{e.params.ver=_ClientInfo.ver;e.params.cli=_ClientInfo.cli}}if(e.headers){}return e||r.when(e)},requestError:function(e){return e},response:function(e){return e||r.when(e)},responseError:function(t){if(t.status===401){var n=r.defer(),i={config:t.config,deferred:n};e.$broadcast("event.NeedLoginException","serv");return n.promise}if(t.status===406){var n=r.defer();e.$broadcast("event.alertm",t.data);return n.promise}return r.reject(t)}}}]).factory("Storage",function(){"use strict";return{set:function(e,r){return window.localStorage.setItem(e,window.JSON.stringify(r))},get:function(e){return window.JSON.parse(window.localStorage.getItem(e))},remove:function(e){return window.localStorage.removeItem(e)},clear:function(){return window.localStorage.clear()}}}).factory("PpService",function(e,r,t,n){return{send:function(r,t){console.log("putPoint:"+r+","+t);var i=n.api+"/putpoint";e({method:"GET",url:i,params:{key:r,ppid:t}}).success()}}}).factory("RegService",function(e,r,t,n,i){return{rega:function(r){var i=t.defer();var o=n.api+"/rega";e({method:"GET",url:o,params:{username:r}}).success(function(e,r,t,n){i.resolve(e)});return i.promise},regb:function(r,i){var o=t.defer();var s=n.api+"/regb";e({method:"GET",url:s,params:{username:username,captcha:i}}).success(function(e,r,t,n){o.resolve(e)});return o.promise},regcb:function(r,i){var o=t.defer();var s=n.api+"/regc";var c=_.extend(r,i);e({method:"GET",url:s,params:c}).success(function(e,r,t,n){o.resolve(e)});return o.promise},dologin:function(r){var i=t.defer();var o=n.api+"/dologin";e({method:"GET",url:o,params:{username:r.username,password:r.password,roleId:r.roleId,isauto:r.isauto}}).success(function(e,r,t,n){i.resolve(e)});return i.promise},dologin1:function(r){var i=t.defer();var o=n.api+"/dologin1";e({method:"GET",url:o,params:{username:r.username,password:r.password}}).success(function(e,r,t,n){i.resolve(e)});return i.promise},getAndroidVersion:function(){return e.post(n.api+"/getAndroidVersion.html").success(function(e,t,n,i){r.$broadcast("lxs.AndroidVersionUpdate",e)})}}}).factory("CommonService",function(e,r,t,n,i){return{alertm:function(e,r){return alertPopup=t.alert({title:r?r:PRJCNAME,template:e,okText:"确定",okType:"button-positive"})},confirm:function(e,r){return confirmPopup=t.confirm({title:r?r:PRJCNAME,template:e,cancelText:"取消",okText:"确定"})},getIOSVersion:function(){return e.post(n.api+"/getIOSVersion.html").success(function(e,t,n,i){r.$broadcast("lxs.IOSVersionUpdate",e)})},getAndroidVersion:function(){return e.post(n.api+"/getAndroidVersion.html").success(function(e,t,n,i){r.$broadcast("lxs.AndroidVersionUpdate",e)})}}}).filter("link",function(e){return function(r){if(typeof r==="string"){var t=/href="\/user\/([\S]+)"/gi;var n=/src="\/\/([\S]+)"/gi;var i=/href="((?!#\/user\/)[\S]+)"/gi;return e.trustAsHtml(r.replace(t,'href="#/user/$1"').replace(n,'src="https://$1"').replace(i,"onClick=\"window.open('$1', '_blank', 'location=yes')\""))}return r}}).filter("protocol",function(){return function(e){if(/^\/\//gi.test(e)){return"https:"+e}else{return e}}}).filter("avatarFilter",function(){return function(e){if(e){e=e.replace("https://avatars.githubusercontent.com","http://7xj5bc.com1.z0.glb.clouddn.com");e=e+"&imageView2/2/w/120"}return e}}).filter("rxFilter",function(){return function(e){if(e){e=e+"&imageView2/2/w/120"}return e}}).filter("to_trusted",["$sce",function(e){return function(r){return e.trustAsHtml(r)}}]).directive("resetImg",function(e){return{restrict:"A",link:function(e,r,t){var n=function(e){if(isblank(e)){e="res/img/ccc.jpg"}else if(e.indexOf("http://")==0||e.indexOf("https://")==0){}else{e=imgbase+e}var t=r.clone(true);t.attr("src",e);t.attr("ng-src",e);r.replaceWith(t);r=t};t.$observe("src",n);t.$observe("ngSrc",n)}}}).directive("autoTab",function(e){return{restrict:"A",link:function(r,t,n){var i=n.href;i="#/tab/R"+pubnowtab+"_"+i.substring(6);var o=t.clone(true);o.attr("href",i);o.attr("ng-href",i);t.replaceWith(o);t=o;e(t.contents())(r)}}}).directive("putPoint",function(e,r,t,n){return{restrict:"A",link:function(e,i,o){i.bind("click",function(){r(function(){var e=n.api+"/putpoint";t({method:"GET",url:e,params:{key:o.putPoint,ppid:o.ppid}})},0)})}}}).directive("dynamic",function(e){return{restrict:"A",replace:true,link:function(r,t,n){r.$watch(n.dynamic,function(n){t.html(n);e(t.contents())(r)})}}}).directive("forbidReSubmit",function(e){return{restrict:"A",link:function(r,t,n){t.on("$destroy",function(){t.attr("disabled",false)});t.bind("click",function(){e(function(){t.attr("disabled",true)},0)})}}});appservice.config(["$httpProvider",function(e){e.interceptors.push("sessionInjector")}]);Array.prototype.remove=function(e){if(isNaN(e)||e>this.length){return false}for(var r=0,t=0;r<this.length;r++){if(this[r]!=this[e]){this[t++]=this[r]}}this.length-=1};