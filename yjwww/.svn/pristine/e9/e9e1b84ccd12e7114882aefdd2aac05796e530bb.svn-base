appctrl.controller("tabCtrl",function(e,n,o,t,i,r,u,a,p,c,s,l,f,d,g,b,m,w,h){o.debug("enter tab ctrl3");e.rolemem=808;e.user={};e.tab="sms";e.countdown=0;e.meuser=g.get(LOGINED_USER_C);if(!e.meuser)e.meuser={};e.memberDoctorWatching={};e.$on("$ionicView.beforeEnter",function(){o.debug("tab ctrl beforeEnter")});e.$on("$ionicView.afterEnter",function(){o.debug("tab ctrl afterEnter")});e.init=function(){o.debug("tab ctrl init")};e.$on("event.NeedLoginException",function(n,t){if(wxNoOpenid()){window.location.href=outGetOpenidUrl;return}o.debug("收到通知：event.NeedLoginException,data="+t);if(t==="reg"){e.user=g.get(REG_USER);e.user.password="";e.user.rememberpwd=true;e.user.autologin=true}else{e.user=g.get(LOGINED_USER_C);if(e.user==null||e.user==="")e.user={}}e.openPopLogin()});e.$on("event.NeedWxpayWindow",function(n,t){o.debug("收到通知：event.NeedWxpayWindow,data="+JSON.stringify(t));e.openPopWxpay();if(_ClientInfo.cli==3){var i=t.obj["WaJsapiPaymentParam"];console.log("by cashticketMember");w.config().then(function(e){console.log("WxService config then ");w.pay(i).then(function(e){})})}if(_ClientInfo.cli===1){var r=t.obj["WaAppapiPaymentParam"];wxpay.pay(r,function(){},function(){})}if(_ClientInfo.cli===2){}if(_ClientInfo.cli==null||_ClientInfo.cli===3){}});e.$on("event.alertm",function(e,n){o.debug("收到通知：event.alertm,data="+n);d.alertm(n).then(function(e){})});e.tabChange=function(n){e.tab=n};e.requestCode=function(n){o.debug("请求验证码");o.debug(n);var t=/^0?1[0-9]{10}$/;if(!t.test(n.mobile)){d.alertm("手机号无效");return}m.requestCode(n.mobile).then(function(){d.alertm("验证码已发送");e.count(60)})};e.count=function(n){e.countdown=n;if(n!=0){t(function(){e.count(n-1)},1e3)}};e.dologinbysms=function(t){if(wxNoOpenid()){window.location.href=outGetOpenidUrl;return}t.roleId=8;o.debug("短信验证登陆");m.dologinbysms(t).then(function(o){e.popLogin.hide();var t=_.clone(e.user);e.user=o;e.user.passwordmd5=e.user.password;g.set(LOGINED_USER_C,e.user);var i=g.get(CLIENT_INFO);if(!i){i=_.clone(_ClientInfo)}i.token=e.user.token;g.set(CLIENT_INFO,i);s.goBack();n.$broadcast("event.logined")})};e.dologin=function(o){if(wxNoOpenid()){window.location.href=outGetOpenidUrl;return}e.user=o;o.roleId=8;o.isauto=0;console.log(o);b.dologin(o).then(function(o){e.popLogin.hide();var t=_.clone(e.user);e.user=o;e.user.passwordmd5=e.user.password;e.user.password=t.password;g.set(LOGINED_USER_C,e.user);var i=g.get(CLIENT_INFO);if(!i){i=_.clone(_ClientInfo)}i.token=e.user.token;g.set(CLIENT_INFO,i);e.meuser=g.get(LOGINED_USER_C);s.goBack();n.$broadcast("event.logined");location.reload()})};e.closePopLogin=function(n){o.debug("closePopLogin");e.popLogin.hide();s.goBack()};r.fromTemplateUrl("views/pub/login.html",{scope:e}).then(function(n){e.popLogin=n});e.openPopLogin=function(n){e.popLogin.show(n)};e.popWxpay={};r.fromTemplateUrl("views/pub/wxpay.html",{scope:e}).then(function(n){e.popWxpay=n});e.openPopWxpay=function(n){e.popWxpay.show(n)};e.popApay={};r.fromTemplateUrl("views/pub/apay.html",{scope:e}).then(function(n){e.popApay=n});e.openPopApay=function(n){e.popApay.show(n)};e.nowtabs=function(n){o.debug("当前的tab="+n);pubnowtab=n;if("B"===n){e.jumpPage("CloudPharmacy")}else if("C"===n){e.jumpPage("Drugstore")}else if("D"===n){e.jumpPage("Mystore")}else{e.jumpPage("DoctorList")}};e.getHalfHeight=function(){return 300};e.rx=function(n){n="R"+pubnowtab+"_"+n.substring(6);e.jumpPage(n)};e.jumpPage=function(e){p.path("/tab/"+e)};e.ctrlMapPut=function(e){ctrlReinitMap.put(e,1)};var y=angular.module("app.directives",[]);y.directive("hideTabs",function(e){return{restrict:"AE",link:function(n,o,t){n.$watch(t.hideTabs,function(n){e.hideTabs=n});n.$on("$destroy",function(){e.hideTabs=false})}}});e.init()});