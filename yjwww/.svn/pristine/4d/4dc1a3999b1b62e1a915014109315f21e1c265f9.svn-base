appctrl.controller("myCtrl",function(e,n,t,r,o,i,a,u,l,c,s,d,f,g,m,p,b,h,v){t.debug("enter my ctrl");var j;e.obj={};e.vm={};var y="http://yijian.zjjnyd.com/yijian/rest";e.$on("$ionicView.beforeEnter",function(){t.debug("my ctrl beforeEnter")});e.$on("$ionicView.afterEnter",function(){t.debug("my ctrl afterEnter");if(ctrlReinitMap.get("myCtrl")){ctrlReinitMap.remove("myCtrl");t.debug("my ctrl afterEnter init");e.init()}});e.init=function(){e.checklogin()};e.get=function(){if(!j)return;p.get(j.id).then(function(n){t.debug("my ctrl get then");e.obj=n})};e.save=function(){if(e.obj.name==""||e.obj.age==""){m.alertm("请完善您的个人信息");return}if(e.obj.age>=120){m.alertm("输入的年龄不能大于120");return}p.update(e.obj).then(function(n){t.debug("my ctrl update then");e.obj=n;m.alertm("信息保存成功");h.goBack()})};e.uploadsave=function(){p.update(e.obj).then(function(n){t.debug("my ctrl update then");e.obj=n;m.alertm("图片上传成功")})};e.login=function(){n.$broadcast("event.NeedLoginException","member")};e.$on("event.logined",function(n,r){t.debug("收到通知：event.logined,data="+r);e.checklogin()});e.checklogin=function(){j=b.get(LOGINED_USER);if(j){t.debug(j);id=j.id;e.obj=e.get();t.debug(e.obj)}};e.logout=function(){m.confirm("确认退出？").then(function(n){if(n){e.user=null;b.remove(LOGINED_USER);var t=b.get(CLIENT_INFO);t.token=null;b.set(CLIENT_INFO,t);location.replace(document.referrer)}else{}})};e.clear=function(){b.clear();m.alertm("清除缓存");e.init()};e.editpassword=function(){m.alertm("请与客服联系，我们确认后分配初始密码")};e.telephone=function(){alert("请拨打客服电话：0571-85389727     咨询购买该药品!")};e.upload=function(n,t){e.errorMsg=null;E(n,t)};function E(n,o){n.upload=v.upload({url:y+"/upload"+e.getReqParams(),resumeSizeUrl:o?y+"/upload?name="+encodeURIComponent(n.name):null,resumeChunkSize:o?e.chunkSize:null,headers:{"optional-header":"header-value"},data:{username:e.username},file:n}).progress(function(n){e.progressPercentage=parseInt(100*n.loaded/n.total);t.debug("progess:"+e.progressPercentage+"%"+n.config.file.name)}).success(function(n){angular.forEach(n.result,function(n){if(n.fieldName=="url"){t.debug(n.value);if(n.value!=null){var r="http://yijian.zjjnyd.com/yijian"+n.value;e.obj.img1=r;e.uploadsave()}}})});n.upload.then(function(e){r(function(){n.result=e.data})},function(n){if(n.status>0)e.errorMsg=n.status+": "+n.data},function(e){n.progress=Math.min(100,parseInt(100*e.loaded/e.total))});n.upload.xhr(function(e){})}e.$watch("files",function(n){t.debug(n);if(n!=null){if(!angular.isArray(n)){r(function(){e.files=n=[n]});return}for(var o=0;o<n.length;o++){v.imageDimensions(n[o]).then(function(n){e.d=n;console.log(n)});e.errorMsg=null;(function(n){e.upload(n,true)})(n[o])}}});e.isResumeSupported=v.isResumeSupported();e.chunkSize=1e5;e.success_action_redirect=e.success_action_redirect||window.location.protocol+"//"+window.location.host;e.jsonPolicy=e.jsonPolicy||'{\n  "expiration": "2020-01-01T00:00:00Z",\n  "conditions": [\n    {"bucket": "angular-file-upload"},\n    ["starts-with", "$key", ""],\n    {"acl": "private"},\n    ["starts-with", "$Content-Type", ""],\n    ["starts-with", "$filename", ""],\n    ["content-length-range", 0, 524288000]\n  ]\n}';e.acl=e.acl||"private";e.getReqParams=function(){return e.generateErrorOnServer?"?errorCode="+e.serverErrorCode+"&errorMessage="+e.serverErrorMsg:""};e.modelOptionsObj={};e.init();ctrlReinitMap.remove("myCtrl")});