appctrl.controller("DoctorCtrl",function(e,t,n,o,r,i,a,c,u,l,d,s,f,g,p,b,h,j,m){n.debug("enter Doctor ctrl");e.user=p.get(LOGINED_USER_B);var v=g.id;v=e.user?e.user.id:0;var D="http://yijian.zjjnyd.com/yijian/rest";e.vm={};e.vm.isedit=false;if(v==="0")e.vm.isedit=true;e.obj={};e.$on("$ionicView.beforeEnter",function(){n.debug("Doctor ctrl beforeEnter");e.user=p.get(LOGINED_USER_B);v=e.user?e.user.id:0});e.$on("$ionicView.afterEnter",function(){n.debug("Doctor ctrl afterEnter");if(ctrlReinitMap.get("DoctorCtrl")){ctrlReinitMap.remove("DoctorCtrl");n.debug("Doctor ctrl afterEnter init");e.init()}});e.init=function(){n.debug("Doctor ctrl init id="+v);e.get()};e.getlocal=function(){n.debug("Doctor ctrl getlocal id="+v);if(isblank0(v)){e.obj=_.clone(_Doctor)}else{e.obj=j.getlocal(v)}n.debug(e.obj)};e.makeProductchannelId=function(){n.debug("productchannelId"+e.obj.productchannelId);e.obj.productchannelId=e.obj.productchannelIdProductchannelObj.id};e.get=function(){n.debug("Doctor ctrl get id="+v);if(isblank0(v)){return}else{j.get(v).then(function(t){e.obj=t;angular.forEach(t.obj1,function(n){angular.forEach(n.children,function(o){if(t.productchannelId==o.id){e.obj.productchannelIdProductchannelObj=o;e.obj.ks1=n}})})})}};e.save=function(){n.debug("Doctor ctrl get id="+v);e.makeProductchannelId();if(isblank0(v)){return}else{j.update(e.obj).then(function(t){n.debug("Doctor ctrl update then");e.obj=t;h.alertm("信息保存成功");s.goBack()})}};e.uploadsave=function(){n.debug("Doctor ctrl get id="+v);n.debug(e.obj);if(isblank0(v)){return}else{j.update(e.obj).then(function(t){n.debug("Doctor ctrl update then");e.obj=t;h.alertm("图片上传成功")})}};e.upload=function(t,n){e.errorMsg=null;E(t,n)};function E(t,r){t.upload=m.upload({url:D+"/upload"+e.getReqParams(),resumeSizeUrl:r?D+"/upload?name="+encodeURIComponent(t.name):null,resumeChunkSize:r?e.chunkSize:null,headers:{"optional-header":"header-value"},data:{username:e.username},file:t}).progress(function(t){e.progressPercentage=parseInt(100*t.loaded/t.total);n.debug("progess:"+e.progressPercentage+"%"+t.config.file.name)}).success(function(t){angular.forEach(t.result,function(t){if(t.fieldName=="url"){n.debug(t.value);if(t.value!=null){var o="http://yijian.zjjnyd.com/yijian"+t.value;e.obj.img1=o;e.uploadsave()}}})});t.upload.then(function(e){o(function(){t.result=e.data})},function(t){if(t.status>0)e.errorMsg=t.status+": "+t.data},function(e){t.progress=Math.min(100,parseInt(100*e.loaded/e.total))});t.upload.xhr(function(e){})}e.$watch("files",function(t){n.debug(t);if(t!=null){if(!angular.isArray(t)){o(function(){e.files=t=[t]});return}for(var r=0;r<t.length;r++){m.imageDimensions(t[r]).then(function(t){e.d=t;console.log(t)});e.errorMsg=null;(function(t){e.upload(t,true)})(t[r])}}});e.isResumeSupported=m.isResumeSupported();e.chunkSize=1e5;e.success_action_redirect=e.success_action_redirect||window.location.protocol+"//"+window.location.host;e.jsonPolicy=e.jsonPolicy||'{\n  "expiration": "2020-01-01T00:00:00Z",\n  "conditions": [\n    {"bucket": "angular-file-upload"},\n    ["starts-with", "$key", ""],\n    {"acl": "private"},\n    ["starts-with", "$Content-Type", ""],\n    ["starts-with", "$filename", ""],\n    ["content-length-range", 0, 524288000]\n  ]\n}';e.acl=e.acl||"private";e.getReqParams=function(){return e.generateErrorOnServer?"?errorCode="+e.serverErrorCode+"&errorMessage="+e.serverErrorMsg:""};e.modelOptionsObj={};e.init();ctrlReinitMap.remove("DoctorCtrl")});