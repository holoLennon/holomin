appservice.service("GaodeService",function(e,n,o,t,r,i,a){r.debug("GaodeService in");var c;var s=[120.17189,30.264664];var u={province:"浙江省",city:"杭州市",citycode:"0571",district:"下城区"};var p;var g=[120.158276,30.285134];var f=[];var l;var d=null;var v=false;var M;var A=new AMap.Icon({image:"res/img/png2/iconfont-dingwei-green.png",size:new AMap.Size(24,24)});var w=new AMap.Icon({image:"res/img/png2/iconfont-dingwei-yellow.png",size:new AMap.Size(24,24)});var m=new AMap.Icon({image:"res/img/png2/iconfont-dingwei-red.png",size:new AMap.Size(24,24)});var h=new AMap.Icon({image:"res/img/png2/iconfont-dingwei-blue.png",size:new AMap.Size(24,24)});var y=new AMap.Icon({image:"res/img/png2/iconfont-dingweidizhigpsditu-blue.png",size:new AMap.Size(24,24)});var L=new AMap.Icon({image:"res/img/png2/iconfont-dingweidizhigpsditu-orange.png",size:new AMap.Size(24,24)});return{retset:function(){amap=null;c=null;l=null;f=[];r.debug("mapaddr reset")},createMap:function(e,n){this.retset();if(!e)e="amap";if(!n)n="gaode_container_shopdrugstore";var o=document.getElementById(e);o.parentNode.style.height="100%";var t=i.get(MAP_CENTER);if(t)s=t;c=new AMap.Map(n,{resizeEnable:true,zoom:DEFMAPLEVEL,center:s});AMap.plugin(["AMap.ToolBar","AMap.Scale","AMap.Geolocation"],function(){var e=new AMap.ToolBar;var n=new AMap.Scale;var o=new AMap.Geolocation({enableHighAccuracy:true,timeout:1e4,maximumAge:0,convert:true,showButton:true,buttonPosition:"LB",buttonOffset:new AMap.Pixel(10,20),showMarker:true,showCircle:true,panToLocation:true,zoomToAccuracy:true});c.addControl(e);c.addControl(n);c.addControl(o)});AMap.service(["AMap.PlaceSearch"],function(){M=new AMap.PlaceSearch({pageSize:10,pageIndex:1,city:u.citycode})});c.on("moveend",this.mapMove);return c},mapMove:function(){c.getCity(function(e){if(e["province"]&&typeof e["province"]==="string"){u.province=e["province"];u.city=e["city"];u.citycode=e["citycode"];u.district=e["district"]}});var e=c.getCenter();i.set(MAP_CENTER,[e.getLng(),e.getLat()])},distance:function(e,n){var o=new AMap.LngLat(e[0],e[1]);var t=new AMap.LngLat(n[0],n[1]);var r=o.distance(t);r=parseInt(r);return r},addMarker:function(e,n){var o=this.findMarker(e);if(o==null){var t=this.getIcon(n);o=new AMap.Marker({map:c,icon:t,position:e});o.itype=n;f.push(o)}return o},onlyMarker:function(e){if(l==null){var n=this.getIcon(0);l=new AMap.Marker({map:c,icon:n,position:e})}else{l.setPosition(e)}},findMarker:function(e){for(var n in f){var o=f[n];if(o.getPosition().getLng()===e[0]&&o.getPosition().getLat()===e[1]){return o}}return null},getIcon:function(e){switch(e){case 1:return w;break;case 2:return m;break;case 10:return h;break;case 11:return y;break;case 12:return L;break;default:return A}},searchMap:function(e){M.search(e,function(e,n){if(e==="complete"&&n.info==="OK"){var o=n.poiList;if(!o)return;var t=o.pois;if(t&&t.length>0){c.setZoomAndCenter(DEFMAPLEVEL,t[0].location)}r.debug("pois length"+t.length)}})},setMyLocate:function(e){g=e},getMyLocate:function(){return g},drivingNav:function(e,n){AMap.service(["AMap.Driving"],function(){if(!p){p=new AMap.Driving({map:c})}if(!n)n=g;p.search(n,e,function(e,n){console.log(n)})})},drivingRouteNav:function(e,n){if(!n)n=g;var o=[form,e];c.plugin("AMap.DragRoute",function(){if(!p)p=new AMap.DragRoute($scope.map,o,AMap.DrivingPolicy.LEAST_FEE);p.search()})},geocoder:function(e){var n=o.defer();AMap.service("AMap.Geocoder",function(){var o=new AMap.Geocoder({city:"010"});o.getAddress(e,function(o,t){var r={status:o,result:t,lnglat:e};n.resolve(r)})});return n.promise},geoByBrowserGdInit:function(){r.debug("geoByBrowserGdInit");c.plugin("AMap.Geolocation",function(){d=new AMap.Geolocation({enableHighAccuracy:true,timeout:1e4,maximumAge:0,convert:true,showButton:true,buttonPosition:"LB",buttonOffset:new AMap.Pixel(10,20),showMarker:true,showCircle:true,panToLocation:true,zoomToAccuracy:true});c.addControl(d);AMap.event.addListener(d,"complete",this.onGeoBrowserComplete);AMap.event.addListener(d,"error",this.onGeoBrowserError)})},getBrowseGdPosition:function(){if(d==null)this.geoByBrowserGdInit();else d.getCurrentPosition()},onGeoBrowserComplete:function(e){r.debug("onGeoBrowserComplete"+e);if(e&&e.position){g=[e.position.getLng(),e.position.getLat()];this.addMarker(g,2);if(v){c.setZoomAndCenter(DEFMAPLEVEL,g)}console.log(g)}},onGeoBrowserError:function(e){r.debug(e);var n="<p>定位失败</p>";switch(e.info){case"PERMISSION_DENIED":n+="浏览器阻止了定位操作";break;case"POSITION_UNAVAILBLE":n+="无法获得当前位置";break;case"TIMEOUT":n+="定位超时";break;default:n+="未知错误";break}},geoByBrowserInit:function(e){r.debug("geoByBrowserInit");v=e;if(navigator.geolocation){navigator.geolocation.getCurrentPosition(this.onGeoBrowserComplete,this.onGeoBrowserError)}},tmp1:function(){return 0},tmp1:function(){return 0},tmp:function(){return 0},getMSearch:function(){return M}}});